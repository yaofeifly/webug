<?php
//禁用错误报告
error_reporting(0);
header("Content-Type: text/html;charset=utf-8");
echo "<title>帮管理员找回mysql帐号密码</title>";
$fname=$_REQUEST['fname'];
if(isset($fname))
{ 
$pic_name=$fname;
$file_sub_path=$_SERVER['DOCUMENT_ROOT']."/topsec/any_file_download_V1.2/data/"; 
$file_path=$file_sub_path.$pic_name; 

echo $file_path;

$hfile = fopen($file_path, "rb") or die("Can not find file: $file_path\n");
Header("Content-type: application/octet-stream");
Header("Content-Transfer-Encoding: binary");
Header("Accept-Ranges: bytes");
Header("Content-Length: ".filesize($file_path));
Header("Content-Disposition: attachment; filename=\"$pic_name\"");
while (!feof($hfile)) {
    echo fread($hfile, 32768);
}
fclose($hfile);
}
?>
<center>图片商城下载测试</center>
<hr/>
<br/>
<form action="" method="post">
<table border="1px">
<tr>
<td>序号</td>
<td>文件预览</td>
<td>下载</td>
</tr>
<tr>
<td>1</td>
<td><img src="data/dog_cat.jpg" width="300px" height="150px"/></td>
<td><a href="?fname=dog_cat.jpg">点我下载</a></td>
</tr>
<tr>
<td>2</td>
<td><img src="data/IT_worker.jpg" width="300px" height="150px"/></td>
<td><a href="?fname=IT_worker.jpg" >点我下载</a></td>
</tr>
</table>
</form>
